os: linux
dist: trusty
language: python
env:
 - ARCH=manylinux1-x64

services:
  - docker

before_script:
  - set -e
 
script:
  - pushd casadi
  - mkdir build_temp
  - pushd build_temp
  - cmake -DSWIG_EXPORT=ON -DWITH_PYTHON=ON ..
  - make python_source
  - cmake -DSWIG_EXPORT=ON -DWITH_PYTHON=ON -DWITH_PYTHON3=ON ..
  - make python_source
  - popd
  - rm -rf build_temp
  - cp ../setup.py ../requirements.txt .
  
before_deploy:
  - export RESULT="$HOME/casadi-source-python-$COMMIT.tar.gz"
  - tar --exclude=".*" -czf $RESULT .
  - export TRAVIS_TAG="commit-$COMMIT"

deploy:
  overwrite: true
  provider: releases
  api_key: $github_token
  file: $RESULT
  skip_cleanup: true
  on:
    all_branches: true

python: 3.6


branches:
  except:
    - /.*appveyor.*/
    - /.*commit.*/
    
before_install: 
  - wget https://raw.githubusercontent.com/casadi/testbot/trial2/before_install.sh && source before_install.sh
  - before_install_debian
  

