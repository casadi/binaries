os: linux
dist: trusty
language: python

services:
  - docker

before_script:
  - set -e
 
script:
  - pushd casadi
  - mkdir build_temp
  - pushd build_temp
  - cmake -DSWIG_EXPORT=ON -DWITH_MATLAB=ON ..
  - make matlab_source
  - popd
  - python ../fix.py
  - rm -rf build_temp
  
before_deploy:
  - export RESULT="$HOME/casadi-source-matlab-$COMMIT.tar.gz"
  - tar -czf $RESULT .
  - export TRAVIS_TAG="commit-$COMMIT"

deploy:
  overwrite: true
  provider: releases
  api_key: $github_token
  file: $RESULT
  skip_cleanup: true
  on:
    all_branches: true

python: 3.6


branches:
  except:
    - /.*appveyor.*/
    - /.*commit.*/
    
before_install: 
  - wget https://raw.githubusercontent.com/casadi/testbot/master/before_install.sh && source before_install.sh
  - before_install_debian
  

